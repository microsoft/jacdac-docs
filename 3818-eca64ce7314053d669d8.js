"use strict";
(self["webpackChunkjacdac_docs"] = self["webpackChunkjacdac_docs"] || []).push([[3818],{

/***/ 13818:
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ DashboardLED; }
/* harmony export */ });
/* harmony import */ var _babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(15861);
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(15725);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(67294);
/* harmony import */ var _widgets_LightWidget__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(87225);
/* harmony import */ var _jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3964);
/* harmony import */ var _widgets_ColorButtons__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(27362);
/* harmony import */ var _hooks_useRegister__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(22878);
/* harmony import */ var _RegisterInput__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(48831);
/* harmony import */ var _jacdac_ts_src_jdom_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(46196);
/* harmony import */ var _jacdac_ts_src_jdom_eventsource__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(53304);
/* harmony import */ var _DashboardRegisterValueFallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(47644);
/* harmony import */ var _jacdac_useRegisterValue__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(9680);
/* harmony import */ var _hooks_useServiceServer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(75938);
/* harmony import */ var _jacdac_ts_src_servers_ledserver__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(80174);
/* harmony import */ var _jacdac_useChange__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(63339);
var configureRegisters=[_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.Brightness */ .Abo.Brightness,_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.ActualBrightness */ .Abo.ActualBrightness,_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.MaxPower */ .Abo.MaxPower];function RegisterInputItem(props){var{service,registerCode,visible}=props;var register=(0,_hooks_useRegister__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(service,registerCode);return/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(_RegisterInput__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z,{register:register,visible:visible,showRegisterName:true});}function DashboardLED(props){var{service,services,visible,expanded,controlled}=props;var pixelsRegister=(0,_hooks_useRegister__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(service,_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.Pixels */ .Abo.Pixels);var numPixelsRegister=(0,_hooks_useRegister__WEBPACK_IMPORTED_MODULE_12__/* ["default"] */ .Z)(service,_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.NumPixels */ .Abo.NumPixels);var[numPixels]=(0,_jacdac_useRegisterValue__WEBPACK_IMPORTED_MODULE_8__/* .useRegisterUnpackedValue */ .Pf)(numPixelsRegister,props);var canEdit=expanded&&numPixels!==undefined&&numPixels<=64;var{0:penColor,1:setPenColor}=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(_widgets_ColorButtons__WEBPACK_IMPORTED_MODULE_3__/* .DEFAULT_COLORS[0].value */ .Q[0].value);var colorsRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Uint8Array(0));var clientRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(new _jacdac_ts_src_jdom_eventsource__WEBPACK_IMPORTED_MODULE_6__/* .JDEventSource */ .aE());var canLedClick=!isNaN(penColor)&&canEdit&&!controlled;var server=(0,_hooks_useServiceServer__WEBPACK_IMPORTED_MODULE_9__/* ["default"] */ .Z)(service,()=>numPixels>64?new _jacdac_ts_src_servers_ledserver__WEBPACK_IMPORTED_MODULE_10__/* .LedServer */ .A():undefined,[numPixels]);var handleColorChange=newColor=>setPenColor(current=>newColor===current?undefined:newColor);var handleLedClick=/*#__PURE__*/function(){var _ref=(0,_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_13__/* ["default"] */ .Z)(function*(index){var pixels=colorsRef.current;if(index>=pixels.length*3)return;var newPixels=pixels.slice(0);var k=index*3;var r=penColor>>16&0xff;var g=penColor>>8&0xff;var b=penColor&0xff;if(newPixels[k]==r&&newPixels[k+1]==g&&newPixels[k+2]==b){r=0;g=0;b=0;}newPixels[k]=r;newPixels[k+1]=g;newPixels[k+2]=b;yield pixelsRegister.sendSetPackedAsync([newPixels],true);colorsRef.current=newPixels;clientRef.current.emit(_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .RENDER */ .kq7);});return function handleLedClick(_x){return _ref.apply(this,arguments);};}();var registers={numPixels:_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.NumPixels */ .Abo.NumPixels,variant:_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.Variant */ .Abo.Variant,actualBrightness:_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.ActualBrightness */ .Abo.ActualBrightness,numColumns:_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .LedReg.NumColumns */ .Abo.NumColumns};(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{if(!pixelsRegister)return undefined;var updatePixels=()=>{var pixels=pixelsRegister.data;if(pixels&&pixels.length&&!(0,_jacdac_ts_src_jdom_utils__WEBPACK_IMPORTED_MODULE_5__/* .bufferEq */ .zo)(colorsRef.current,pixels)){colorsRef.current=pixels.slice(0);clientRef.current.emit(_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .RENDER */ .kq7);}};updatePixels();return pixelsRegister.subscribe(_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .REPORT_UPDATE */ .rGZ,updatePixels);},[pixelsRegister]);(0,_jacdac_useChange__WEBPACK_IMPORTED_MODULE_11__/* ["default"] */ .Z)(server===null||server===void 0?void 0:server.pixels,_=>{var pixels=_===null||_===void 0?void 0:_.data;if(pixels&&pixels.length&&!(0,_jacdac_ts_src_jdom_utils__WEBPACK_IMPORTED_MODULE_5__/* .bufferEq */ .zo)(colorsRef.current,pixels)){colorsRef.current=pixels.slice(0);clientRef.current.emit(_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .RENDER */ .kq7);}},[server]);var colors=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>colorsRef.current,[]);var subscribeColors=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(handler=>clientRef.current.subscribe(_jacdac_ts_src_jdom_constants__WEBPACK_IMPORTED_MODULE_2__/* .RENDER */ .kq7,handler),[]);if(numPixels===undefined)return/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(_DashboardRegisterValueFallback__WEBPACK_IMPORTED_MODULE_7__/* ["default"] */ .Z,{register:numPixelsRegister});if(!numPixels)return null;return/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .ZP,{item:true,xs:12},/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(_widgets_LightWidget__WEBPACK_IMPORTED_MODULE_1__/* ["default"] */ .Z,Object.assign({colors:colors,subscribeColors:subscribeColors,registers:registers,widgetCount:services===null||services===void 0?void 0:services.length,onLedClick:canLedClick?handleLedClick:undefined},props))),canEdit&&/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .ZP,{item:true},/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(_widgets_ColorButtons__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z,{color:penColor,onColorChange:handleColorChange})),expanded&&configureRegisters.map(code=>/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_14__/* ["default"] */ .ZP,{item:true,xs:12,key:code},/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement(RegisterInputItem,{service:service,registerCode:code,visible:visible}))));}

/***/ })

}]);
//# sourceMappingURL=3818-eca64ce7314053d669d8.js.map