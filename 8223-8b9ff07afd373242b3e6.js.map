{"version":3,"file":"8223-8b9ff07afd373242b3e6.js","mappings":"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","sources":["webpack://jacdac-docs/../src/components/intersection-observer.ts","webpack://jacdac-docs/../src/components/lazy-hydrate.tsx"],"sourcesContent":["let intersectionObserver: IntersectionObserver\n\nexport type Unobserver = () => void\n\nconst ioEntryMap = new WeakMap<HTMLElement, () => void>()\n/* eslint-disable @typescript-eslint/no-explicit-any  */\nconst connection =\n  (navigator as any).connection ||\n  (navigator as any).mozConnection ||\n  (navigator as any).webkitConnection\n/* eslint-enable @typescript-eslint/no-explicit-any */\n\n// These match the thresholds used in Chrome's native lazy loading\n// @see https://web.dev/browser-level-image-lazy-loading/#distance-from-viewport-thresholds\nconst FAST_CONNECTION_THRESHOLD = `1250px`\nconst SLOW_CONNECTION_THRESHOLD = `2500px`\n\nexport function createIntersectionObserver(\n  callback: () => void\n): (element: HTMLElement) => Unobserver {\n  const connectionType = connection?.effectiveType\n\n  // if we don't support intersectionObserver we don't lazy load (Sorry IE 11).\n  if (!(`IntersectionObserver` in window)) {\n    return function observe(): Unobserver {\n      callback()\n      return function unobserve(): void {}\n    }\n  }\n\n  if (!intersectionObserver) {\n    intersectionObserver = new IntersectionObserver(\n      entries => {\n        entries.forEach(entry => {\n          if (entry.isIntersecting) {\n            // Get the matching entry's callback and call it\n            ioEntryMap.get(entry.target as HTMLElement)?.()\n            // We only need to call it once\n            ioEntryMap.delete(entry.target as HTMLElement)\n          }\n        })\n      },\n      {\n        rootMargin:\n          connectionType === `4g` && !connection?.saveData\n            ? FAST_CONNECTION_THRESHOLD\n            : SLOW_CONNECTION_THRESHOLD,\n      }\n    )\n  }\n\n  return function observe(element: HTMLElement): Unobserver {\n    // Store a reference to the callback mapped to the element being watched\n    ioEntryMap.set(element, callback)\n    intersectionObserver.observe(element)\n\n    return function unobserve(): void {\n      if (intersectionObserver && element) {\n        ioEntryMap.delete(element)\n        intersectionObserver.unobserve(element)\n      }\n    }\n  }\n}\n","import React from \"react\"\nimport { renderToStaticMarkup } from \"react-dom/server\"\nimport { LayoutWrapper } from \"./layout-wrapper\"\nimport { Placeholder } from \"./placeholder\"\nimport { MainImage } from \"./main-image\"\nimport {\n  hasNativeLazyLoadSupport,\n  getMainProps,\n  getPlaceholderProps,\n} from \"./hooks\"\nimport { createIntersectionObserver } from \"./intersection-observer\"\nimport type { MainImageProps } from \"./main-image\"\nimport type { GatsbyImageProps } from \"./gatsby-image.browser\"\n\ntype LazyHydrateProps = Omit<GatsbyImageProps, \"as\" | \"style\" | \"className\"> & {\n  isLoading: boolean\n  isLoaded: boolean\n}\n\nasync function applyPolyfill(element: HTMLImageElement): Promise<void> {\n  if (!(`objectFitPolyfill` in window)) {\n    await import(\n      // @ts-ignore typescript can't find the module for some reason ¯\\_(ツ)_/¯\n      /* webpackChunkName: \"gatsby-plugin-image-objectfit-polyfill\" */ `objectFitPolyfill`\n    )\n  }\n  ;(window as any).objectFitPolyfill(element)\n}\n\nfunction toggleLoaded(\n  mainImage: HTMLElement,\n  placeholderImage: HTMLElement\n): void {\n  mainImage.style.opacity = `1`\n\n  if (placeholderImage) {\n    placeholderImage.style.opacity = `0`\n  }\n}\n\nfunction startLoading(\n  element: HTMLElement,\n  cacheKey: string,\n  imageCache: Set<string>,\n  onStartLoad: GatsbyImageProps[\"onStartLoad\"],\n  onLoad: GatsbyImageProps[\"onLoad\"],\n  onError: GatsbyImageProps[\"onError\"]\n): () => void {\n  const mainImage = element.querySelector(\n    `[data-main-image]`\n  ) as HTMLImageElement\n  const placeholderImage = element.querySelector<HTMLElement>(\n    `[data-placeholder-image]`\n  )\n  const isCached = imageCache.has(cacheKey)\n\n  function onImageLoaded(e): void {\n    // eslint-disable-next-line @babel/no-invalid-this\n    this.removeEventListener(`load`, onImageLoaded)\n\n    const target = e.currentTarget\n    const img = new Image()\n    img.src = target.currentSrc\n\n    if (img.decode) {\n      // Decode the image through javascript to support our transition\n      img\n        .decode()\n        .then(() => {\n          // eslint-disable-next-line @babel/no-invalid-this\n          toggleLoaded(this, placeholderImage)\n          onLoad?.({\n            wasCached: isCached,\n          })\n        })\n        .catch(e => {\n          // eslint-disable-next-line @babel/no-invalid-this\n          toggleLoaded(this, placeholderImage)\n          onError?.(e)\n        })\n    } else {\n      // eslint-disable-next-line @babel/no-invalid-this\n      toggleLoaded(this, placeholderImage)\n      onLoad?.({\n        wasCached: isCached,\n      })\n    }\n  }\n\n  mainImage.addEventListener(`load`, onImageLoaded)\n\n  onStartLoad?.({\n    wasCached: isCached,\n  })\n  Array.from(mainImage.parentElement.children).forEach(child => {\n    const src = child.getAttribute(`data-src`)\n    const srcSet = child.getAttribute(`data-srcset`)\n    if (src) {\n      child.removeAttribute(`data-src`)\n      child.setAttribute(`src`, src)\n    }\n    if (srcSet) {\n      child.removeAttribute(`data-srcset`)\n      child.setAttribute(`srcset`, srcSet)\n    }\n  })\n\n  imageCache.add(cacheKey)\n\n  // Load times not always fires - mostly when it's a 304\n  // We check if the image is already completed and if so we trigger onload.\n  if (mainImage.complete) {\n    onImageLoaded.call(mainImage, {\n      currentTarget: mainImage,\n    })\n  }\n\n  return (): void => {\n    if (mainImage) {\n      mainImage.removeEventListener(`load`, onImageLoaded)\n    }\n  }\n}\n\nexport function swapPlaceholderImage(\n  element: HTMLElement,\n  cacheKey: string,\n  imageCache: Set<string>,\n  style: React.CSSProperties,\n  onStartLoad: GatsbyImageProps[\"onStartLoad\"],\n  onLoad: GatsbyImageProps[\"onLoad\"],\n  onError: GatsbyImageProps[\"onError\"]\n): () => void {\n  if (!hasNativeLazyLoadSupport()) {\n    let cleanup\n    const io = createIntersectionObserver(() => {\n      cleanup = startLoading(\n        element,\n        cacheKey,\n        imageCache,\n        onStartLoad,\n        onLoad,\n        onError\n      )\n    })\n    const unobserve = io(element)\n\n    // Polyfill \"object-fit\" if unsupported (mostly IE)\n    if (!(`objectFit` in document.documentElement.style)) {\n      element.dataset.objectFit = style.objectFit ?? `cover`\n      element.dataset.objectPosition = `${style.objectPosition ?? `50% 50%`}`\n      applyPolyfill(element as HTMLImageElement)\n    }\n\n    return (): void => {\n      if (cleanup) {\n        cleanup()\n      }\n\n      unobserve()\n    }\n  }\n\n  return startLoading(\n    element,\n    cacheKey,\n    imageCache,\n    onStartLoad,\n    onLoad,\n    onError\n  )\n}\n\nexport function renderImageToString({\n  image,\n  loading = `lazy`,\n  isLoading,\n  isLoaded,\n  imgClassName,\n  imgStyle = {},\n  objectPosition,\n  backgroundColor,\n  objectFit = `cover`,\n  ...props\n}: LazyHydrateProps): string {\n  const {\n    width,\n    height,\n    layout,\n    images,\n    placeholder,\n    backgroundColor: wrapperBackgroundColor,\n  } = image\n\n  imgStyle = {\n    objectFit,\n    objectPosition,\n    backgroundColor,\n    ...imgStyle,\n  }\n\n  return renderToStaticMarkup(\n    <LayoutWrapper layout={layout} width={width} height={height}>\n      <Placeholder\n        {...getPlaceholderProps(\n          placeholder,\n          isLoaded,\n          layout,\n          width,\n          height,\n          wrapperBackgroundColor,\n          objectFit,\n          objectPosition\n        )}\n      />\n\n      <MainImage\n        {...(props as Omit<\n          MainImageProps,\n          \"images\" | \"fallback\" | \"onLoad\" | \"onError\"\n        >)}\n        width={width}\n        height={height}\n        className={imgClassName}\n        {...getMainProps(isLoading, isLoaded, images, loading, imgStyle)}\n      />\n    </LayoutWrapper>\n  )\n}\n"],"names":["navigator","connection","mozConnection","webkitConnection","callback","effectiveType","intersectionObserver","entries","forEach","entry","isIntersecting","ioEntryMap","get","target","delete","rootMargin","saveData","element","set","observe","unobserve","async","window","objectFitPolyfill","mainImage","placeholderImage","style","opacity","cacheKey","imageCache","onStartLoad","onLoad","onError","querySelector","has","e","this","removeEventListener","onImageLoaded","currentTarget","img","src","currentSrc","decode","then","toggleLoaded","wasCached","isCached","catch","addEventListener","Array","from","parentElement","children","child","getAttribute","removeAttribute","setAttribute","srcSet","add","complete","call","hasNativeLazyLoadSupport","cleanup","startLoading","io","documentElement","dataset","objectFit","objectPosition","applyPolyfill","image","loading","isLoading","isLoaded","imgClassName","imgStyle","backgroundColor","props","width","height","layout","images","placeholder","wrapperBackgroundColor","React","LayoutWrapper","Placeholder","getPlaceholderProps","MainImage","className","getMainProps"],"sourceRoot":""}